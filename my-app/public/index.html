<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Portfolio</title>
    <!-- Link CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <!-- Scripts externos -->
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12" defer></script>
    <script src="https://unpkg.com/@buildshipapp/chat-widget@^1" defer></script>
    <!-- Script principal -->
    <script defer src="/static/js/bundle.js"></script>
    <script type="module" src="src/settings.js"></script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5KBGG57T"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="root"></div>
    <!-- Button to open the widget -->
    <button data-buildship-chat-widget-button>
        <i class="fas fa-robot"></i> <span id="chat-widget-button-text">Hello!</span>
    </button>
    <!-- Añadir botón de configuración -->
    <button class="settings-toggle" onclick="toggleSettings()" aria-label="Toggle settings">
        <img src="assets/files/gear.svg" alt="Settings" class="settings-icon" />
    </button>
    <div class="settings-menu" id="settings-menu" style="display: none;">
        <div class="settings-option" id="light-mode" onclick="setActiveSetting('light')">
            <div class="tooltip">Light Mode</div>
            <i class="fas fa-sun"></i>
        </div>
        <div class="settings-option" id="dark-mode" onclick="setActiveSetting('dark')">
            <div class="tooltip">Dark Mode</div>
            <i class="fas fa-moon"></i>
        </div>
        <div class="settings-option" id="system-mode" onclick="setActiveSetting(getSystemTheme())">
            <div class="tooltip">System Theme</div>
            <i class="fas fa-desktop"></i>
        </div>
        <div class="settings-option language-toggle" id="language-toggle">
            <img id="language-flag" src="assets/files/flag-us.png" alt="Flag" class="flag-image"/>
            <span id="language-text" class="language-toggle-button">EN</span>
        </div>
    </div>

    <!-- Scripts internos -->
    <script>
        function scrollToSection(id) {
            const element = document.getElementById(id);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        function configureChatWidget(language) {
            const messages = {  
                es: `
Hola! Soy un <b>Chatbot desarrollado por <a href="https://elelier.com" target="_blank" style="color: #7dd3fc;">Elier Loya Mata</a></b> para <b><a href="#hero-banner" style="color: #7dd3fc;">este portafolio</a></b>.
<br><br>
<b>¿Cómo puedo asistirte hoy?</b>
<ul style="color: #f6f9fc; padding-left: 20px;">
  <li><a href="#portafolio" onclick="scrollToSection('portafolio'); return false;" style="color: #7dd3fc;">Ver Proyectos</a></li>
  <li><a href="#servicios" onclick="scrollToSection('servicios'); return false;" style="color: #7dd3fc;">Conocer Servicios</a></li>
  <li><a href="#contacto" onclick="scrollToSection('contacto'); return false;" style="color: #7dd3fc;">Contáctame</a></li>
  <li><a href="#sobre-mi" onclick="scrollToSection('sobre-mi'); return false;" style="color: #7dd3fc;">Más Sobre Mi</a></li>
</ul>
<br>
Explora <a href="#hero-banner" onclick="scrollToSection('hero-banner'); return false;" style="color: #7dd3fc;">mi sitio web</a> para más información.
<br><br>
¡Estoy aquí para ayudarte a encontrar lo que necesitas!
<br><br>
<b><a href="#" onclick="changeLanguage('en'); return false;" style="color: #7dd3fc;">Change to English</a></b>
                `,
                en: `
Hello! I'm a <b>Chatbot developed by <a href="https://elelier.com" target="_blank" style="color: #7dd3fc;">Elier Loya Mata</a></b> for <b><a href="#hero-banner" style="color: #7dd3fc;">this portfolio</a></b>.
<br><br>
<b>How can I assist you today?</b>
<ul style="color: #f6f9fc; padding-left: 20px;">
  <li><a href="#portafolio" onclick="scrollToSection('portafolio'); return false;" style="color: #7dd3fc;">See Projects</a></li>
  <li><a href="#servicios" onclick="scrollToSection('servicios'); return false;" style="color: #7dd3fc;">Know Services</a></li>
  <li><a href="#contacto" onclick="scrollToSection('contacto'); return false;" style="color: #7dd3fc;">Contact Me</a></li>
  <li><a href="#sobre-mi" onclick="scrollToSection('sobre-mi'); return false;" style="color: #7dd3fc;">More About Me</a></li>
</ul>
<br>
Explore <a href="#hero-banner" onclick="scrollToSection('hero-banner'); return false;" style="color: #7dd3fc;">my website</a> for more information.
<br><br>
I'm here to help you find what you need!
<br><br>
<b><a href="#" onclick="changeLanguage('es'); return false;" style="color: #7dd3fc;">Cambiar a Español</a></b>
                `
            };

            const buttonTexts = {
                es: "¡HOLA!",
                en: "Hello!"
            };

            if (window.buildShipChatWidget && window.buildShipChatWidget.config) {
                window.buildShipChatWidget.config.url = "https://81ocg9.buildship.run/el_bot";
                window.buildShipChatWidget.config.widgetTitle = language === 'es' ? "¿Quieres un Chatbot?" : "Want a Chatbot?";
                window.buildShipChatWidget.config.widgetBranding = language === 'es' ? "¿Quieres un chatbot para ti?" : "Want a chatbot for you?";
                window.buildShipChatWidget.config.greetingMessage = messages[language] || messages['en'];
                window.buildShipChatWidget.config.width = 300; 
                window.buildShipChatWidget.config.height = 500; 
            } else {
                console.error('Chat widget configuration not available');
            }

            const chatButtonText = document.getElementById("chat-widget-button-text");
            if (chatButtonText) {
                chatButtonText.textContent = buttonTexts[language] || buttonTexts['en'];
            }

            setTimeout(() => {
                const titleElement = document.querySelector('.buildship-chat-widget__branding');
                if (titleElement) {
                    titleElement.style.display = 'none';
                }
            }, 1000); 
        }

        function changeLanguage(newLanguage) {
            localStorage.setItem('language', newLanguage);
            window.location.reload(); // Refresh the page with the new language
        }

        function toggleSettings() {
            const menu = document.getElementById("settings-menu");
            if (menu) {
                menu.style.display = menu.style.display === "none" ? "block" : "none";
            }
        }

        function setActiveSetting(setting) {
            const body = document.body;
            const settings = document.querySelectorAll(".settings-option");
            settings.forEach(setting => setting.classList.remove("active"));
            document.getElementById(`${setting}-mode`).classList.add("active");
            switch (setting) {
                case 'light':
                    body.classList.add("light-mode");
                    body.classList.remove("dark-mode");
                    break;
                case 'dark':
                    body.classList.add("dark-mode");
                    body.classList.remove("light-mode");
                    break;
                default:
                    body.classList.remove("light-mode", "dark-mode");
                    break;
            }
        }

        function getSystemTheme() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function getSystemLanguage() {
            // Obtiene el idioma del navegador
            const userLanguage = navigator.language || navigator.userLanguage;
            // Extrae el código de idioma de dos letras
            const languageCode = userLanguage.substring(0, 2);
            // Retorna 'en' si el código no es 'en' o 'es'
            return (languageCode === 'en' || languageCode === 'es') ? languageCode : 'en';
        }

        function updateLanguageDisplay(language) {
            const flagImage = document.getElementById('language-flag');
            const languageText = document.getElementById('language-text');

            if (flagImage && languageText) {
                if (language === 'es') {
                    flagImage.src = 'assets/files/flag-mx.png';
                    languageText.textContent = 'ES';
                } else {
                    flagImage.src = 'assets/files/flag-us.png';
                    languageText.textContent = 'EN';
                }
            }
        }

        window.addEventListener('DOMContentLoaded', () => {
            // Obtiene el idioma almacenado o detecta el idioma del navegador
            const storedLanguage = localStorage.getItem('language');
            const currentLanguage = storedLanguage || getSystemLanguage();
            
            // Actualiza la interfaz con el idioma actual
            updateLanguageDisplay(currentLanguage);
            
            // Configura el evento para cambiar el idioma al hacer clic
            document.getElementById('language-toggle').addEventListener('click', () => {
                const newLanguage = currentLanguage === 'en' ? 'es' : 'en';
                localStorage.setItem('language', newLanguage);
                updateLanguageDisplay(newLanguage);
                // Opcionalmente recarga la página para aplicar el cambio
                // window.location.reload();
            });
        });

        function updateLanguageDisplay(language) {
            const htmlElement = document.documentElement;

            if (language === 'es') {
                htmlElement.lang = 'es'; // Cambia el atributo lang a 'es'
            } else {
                htmlElement.lang = 'en'; // Cambia el atributo lang a 'en'
            }
        }

        function handleClickOutside(event) {
            const settingsMenu = document.getElementById("settings-menu");
            const settingsButton = document.querySelector(".settings-toggle");
            if (settingsMenu && settingsButton) {
                if (!settingsMenu.contains(event.target) && !settingsButton.contains(event.target)) {
                    settingsMenu.style.display = "none";
                }
            }
        }

        document.addEventListener('click', handleClickOutside);

        document.addEventListener('DOMContentLoaded', () => {
            const language = localStorage.getItem('language') || 'en';
            configureChatWidget(language);
            document.body.style.fontFamily = 'Arial, sans-serif'; // Example of global styling
        });
    </script>
</body>
</html>
